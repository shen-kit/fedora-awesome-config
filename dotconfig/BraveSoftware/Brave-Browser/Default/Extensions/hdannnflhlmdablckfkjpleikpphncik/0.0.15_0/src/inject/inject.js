chrome.runtime.sendMessage({},function (o){var p={settings:{speed:1.0,speedStep:0.25,slowerKeyCode:"109,189",fasterKeyCode:"107,187",resetKeyCode:"106",displayOption:"FadeInFadeOut",displayPosition:"TopRight",allowMouseWheel:true,rememberSpeed:false,hideSettingButton:false,enableAllVideosButton:true,secSaved:0,},}; var q; chrome.storage.sync.get(p.settings,function (M){p.settings.speed=Number(M.speed); p.settings.speedStep=Number(M.speedStep); p.settings.slowerKeyCode=M.slowerKeyCode; p.settings.fasterKeyCode=M.fasterKeyCode; p.settings.resetKeyCode=M.resetKeyCode; p.settings.displayOption=M.displayOption; p.settings.displayPosition=M.displayPosition; p.settings.allowMouseWheel=Boolean(M.allowMouseWheel); p.settings.rememberSpeed=Boolean(M.rememberSpeed); p.settings.hideSettingButton=Boolean(M.hideSettingButton); p.settings.enableAllVideosButton=Boolean(M.enableAllVideosButton); p.settings.secSaved=Number(M.secSaved); q=setInterval(s,10);}); var r=null;function s(){if(document.readyState==="complete"){if(location.hostname!="www.youtube.com"&&!p.settings.enableAllVideosButton){return;}clearInterval(q); p.videoController=function (R){this.video=R; if(!p.settings.rememberSpeed){p.settings.speed=1.0;}this.initializeControls(); R.addEventListener("play",function (V){R.playbackRate=p.settings.speed;}); R.addEventListener("ratechange",function (V){if(R.readyState===0){return;}var W=this.getSpeed(); this.speedIndicator.textContent=W; p.settings.speed=W; chrome.storage.sync.set({speed:W,});}.bind(this)); R.playbackRate=p.settings.speed;}; p.videoController.prototype.getSpeed=function (){return parseFloat(this.video.playbackRate).toFixed(2);}; p.videoController.prototype.remove=function (){this.parentElement.removeChild(this);}; p.videoController.prototype.initializeControls=function (){var R=document.createDocumentFragment(); var S=document.createElement("div"); S.setAttribute("id","PlayBackRatePanelYPSC"); S.className="PlayBackRatePanelYPSC"; var T=document.createElement("button"); T.setAttribute("id","PlayBackRateYPSC"); T.className="btnYPSC"; var U=document.createElement("button"); U.setAttribute("id","SettingYPSC"); U.className="btnYPSC"; var NR=document.createElement("button"); NR.setAttribute("id","SpeedDownYPSC"); NR.className="btnYPSC btnYPSC-left"; NR.textContent="<<"; var NS=document.createElement("button"); NS.setAttribute("id","SpeedUpYPSC"); NS.className="btnYPSC btnYPSC-right"; NS.textContent=">>"; if(p.settings.displayOption=="None"){S.style.display="none";}else if(p.settings.displayOption=="Always"){S.style.display="inline"; if(p.settings.hideSettingButton){U.style.display="none";}}else if(p.settings.displayOption=="Simple"){S.style.display="inline"; U.style.display="none"; NS.style.display="none"; NR.style.display="none"; U.style.display="none"; T.style.border="none"; T.style.background="transparent";}else if(p.settings.displayOption=="FadeInFadeOut"){S.style.display="none"; if(p.settings.hideSettingButton){U.style.display="none";}}else{S.style.display="inline";}O1(S,false); S.appendChild(NS); S.appendChild(T); S.appendChild(NR); S.appendChild(U); R.appendChild(S); var NT=this.video.parentElement; if(NT!=null)NT=this.video.parentElement.parentElement??this.video.parentElement; else NT=this.video; NT.insertBefore(R,this.video.parentElement); NT.addEventListener("mouseover",N); NT.addEventListener("mouseout",O); NT.addEventListener("mousemove",P); NT.addEventListener("mouseleave",Q); var NU=parseFloat(p.settings.speed).toFixed(2); T.textContent=NU; this.speedIndicator=T; S.addEventListener("click",function (V){if(V.target===NR){IP("slower");}else if(V.target===NS){IP("faster");}else if(V.target===T){IP("reset");}else if(V.target===U){chrome.runtime.sendMessage({action:"openOptionsPage"});}V.preventDefault(); V.stopPropagation();},true); S.addEventListener("dblclick",function (V){V.preventDefault(); V.stopPropagation();},true);}; document.addEventListener("keydown",function (R){var S=R.which; if((document.activeElement.nodeName==="INPUT"&&document.activeElement.getAttribute("type")==="text")||(document.activeElement.parentElement.nodeName==="YT-FORMATTED-STRING"&&document.activeElement.parentElement.getAttribute("id")==="contenteditable-textarea")){return false;}if(p.settings.fasterKeyCode.match(new RegExp("(?:^|,)"+S+"(?:,|$)"))){IP("faster");}else if(p.settings.slowerKeyCode.match(new RegExp("(?:^|,)"+S+"(?:,|$)"))){IP("slower");}else if(p.settings.resetKeyCode.match(new RegExp("(?:^|,)"+S+"(?:,|$)"))){IP("reset");}return false;},true); const config={attributes:true,childList:true,subtree:true}; const callback=(mutationList,observer)=>{for(const mutation of mutationList){if(mutation.type==="childList"){mutation.addedNodes.forEach(function (R){if(typeof R==="function")return; if(R&&R.nodeName==="VIDEO"){new p.videoController(R);}});}}}; const observer=new MutationObserver(callback); observer.observe(document,config); if(p.settings.allowMouseWheel){document.addEventListener("mousewheel",function (R){if(R.shiftKey){if("wheelDelta"in R){rolled=R.wheelDelta; if(rolled>0)IP("faster"); else if(rolled<0)IP("slower");}}},false);}document.addEventListener("fullscreenchange",function (){IQ();},false); document.addEventListener("msfullscreenchange",function (){IQ();},false); document.addEventListener("mozfullscreenchange",function (){IQ();},false); document.addEventListener("webkitfullscreenchange",function (){IQ();},false); var M=document.getElementsByTagName("video"); M.forEach=Array.prototype.forEach; M.forEach(function (R){var S=new p.videoController(R); setInterval(function (){try{chrome.storage.sync.get(p.settings,function (Y){if(R===null||R===undefined)return; if(!R.paused&&!R.ended){if(R.playbackRate>1){chrome.storage.sync.set({secSaved:Y.secSaved+(R.playbackRate-1),});}}var Z=document.querySelectorAll(".PlayBackRatePanelYPSC,.PlayBackRatePanelYPSCFullScreen"); for(let i=0; i<Z.length; i++){if(R.style.width=="400px"){O1(Z[i],true);}else O1(Z[i],false);}});}catch(err){}},1000);});function N(){if(p.settings.displayOption=="FadeInFadeOut"){clearTimeout(r); IN(); r=setTimeout(IM,1000);}}function O(){if(p.settings.displayOption=="FadeInFadeOut"){IM();}}function P(){if(p.settings.displayOption=="FadeInFadeOut"){clearTimeout(r); IN(); r=setTimeout(IM,1000);}}function Q(){if(p.settings.displayOption=="FadeInFadeOut"){clearTimeout(r); IM();}}function IM(){var R=document.querySelectorAll(".PlayBackRatePanelYPSC,.PlayBackRatePanelYPSCFullScreen"); for(let i=0; i<R.length; i++){R[i].style.display="none";}}function IN(){var R=document.querySelectorAll(".PlayBackRatePanelYPSC,.PlayBackRatePanelYPSCFullScreen"); for(let i=0; i<R.length; i++){R[i].style.display="inline";}}function IO(R,S){R.playbackRate=S;}function IP(R){var M=document.getElementsByTagName("video"); M.forEach=Array.prototype.forEach; M.forEach(function (V){if(!V.classList.contains("vc-cancelled")){if(R==="faster"){var W=Math.min(V.playbackRate+p.settings.speedStep,16); IO(V,W);}else if(R==="slower"){var W=Math.max(V.playbackRate-p.settings.speedStep,0); IO(V,W);}else if(R==="reset"){var W=Math.max(1,0); IO(V,W);}}}); var S=document.querySelectorAll(".PlayBackRatePanelYPSC,.PlayBackRatePanelYPSCFullScreen"); for(let i=0; i<S.length; i++){var T=S[i].style.display; if(T==="none"){S[i].style.display="inline"; setTimeout(function (){S[i].style.display=T;},300);}}}function IQ(){var R=document.querySelectorAll(".PlayBackRatePanelYPSC,.PlayBackRatePanelYPSCFullScreen"); for(let i=0; i<R.length; i++){if(document.webkitIsFullScreen==true){R[i].className="PlayBackRatePanelYPSCFullScreen";}else{R[i].className="PlayBackRatePanelYPSC";}O1(R[i],false);}}function O1(R,S){if(p.settings.displayPosition=="TopRight"){R.style.top="2px"; if(S)R.style.right="0px"; else R.style.right="-44px"; R.style.bottom="initial"; R.style.left="initial";}else if(p.settings.displayPosition=="TopCenter"){R.style.top="2px"; R.style.right="initial"; R.style.bottom="initial"; R.style.left="50%";}else if(p.settings.displayPosition=="TopLeft"){R.style.top="2px"; R.style.right="initial"; R.style.bottom="initial"; if(S)R.style.left="88px"; else R.style.left="64px";}else if(p.settings.displayPosition=="BottomRight"){R.style.top="initial"; R.style.right="-44px"; R.style.bottom="6%"; R.style.left="initial";}else if(p.settings.displayPosition=="BottomCenter"){R.style.top="initial"; R.style.right="initial"; R.style.bottom="5px"; R.style.left="50%";}else if(p.settings.displayPosition=="BottomLeft"){R.style.top="initial"; R.style.right="initial"; R.style.bottom="6%"; R.style.left="44px";}}}}}
);chrome.runtime.sendMessage("show_page_action");
